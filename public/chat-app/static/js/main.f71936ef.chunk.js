(this["webpackJsonpwsata-chat-app"]=this["webpackJsonpwsata-chat-app"]||[]).push([[0],{55:function(e){e.exports=JSON.parse('{"projectId":"alwsata-app","apiKey":"AIzaSyDYsB2PevvI0sVO1u9LHxwr56MDUtoEX7g","authDomain":"alwsata-app.firebaseapp.com","databaseURL":"https://alwsata-app-default-rtdb.firebaseio.com","storageBucket":"alwsata-app.appspot.com","messagingSenderId":"1032367025637","appId":"1:1032367025637:web:338736ecc3cfea305c130c","measurementId":"G-S7VES0NL3F"}')},79:function(e,t,a){},86:function(e,t,a){"use strict";a.r(t);var r=a(2),n=a.n(r),c=a(37),s=a.n(c),i=(a(79),a(0)),o=a.n(i),l=a(5),u=a(29),d=a(15);function m(e){var t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}function x(e){return"file"===e.type?"\u0623\u0631\u0633\u0644 \u0644\u0643 \u0645\u0644\u0641":"image"===e.type?"\u0623\u0631\u0633\u0644 \u0644\u0643 \u0635\u0648\u0631\u0629":"transferring"===e.type||e.text&&e.text.length>0?e.text:"\u0623\u0631\u0633\u0644 \u0644\u0643 \u0631\u0633\u0627\u0644\u0629"}var j=a(4);function f(e){return Object(j.jsx)("main",{className:"overflow-y-auto py-8 flex flex-col ".concat(e.className),children:e.children})}function p(e){return Object(j.jsx)("div",{className:"max-w-2xl mx-auto px-6 w-full",children:e.children})}function b(e){var t=Object(r.useState)(""),a=Object(d.a)(t,2),n=a[0],c=a[1],s=Object(r.useRef)(null),i=Object(r.useRef)(null),o=(Object(r.useRef)(null),function(){s.current&&(s.current.style.height="1.75em",s.current.style.height=s.current.scrollHeight+"px")}),l=function(){var t,a,r=n.trim().replace(/\n\s*\n\s*\n/g,"\n\n");r.length&&(e.onSend(r),c(""),null===(t=i.current)||void 0===t||t.reset(),null===s||void 0===s||null===(a=s.current)||void 0===a||a.focus())};return Object(r.useEffect)(o,[n]),Object(j.jsx)("div",{className:"bg-primary-600 text-white",children:Object(j.jsxs)("form",{ref:i,onSubmit:function(e){e.preventDefault(),l()},className:"flex items-end py-4 px-4 2xl:px-0 space-x-4 space-x-reverse max-w-2xl mx-auto",children:[Object(j.jsx)("textarea",{ref:s,autoFocus:!0,rows:1,value:n,placeholder:"\u0623\u062f\u062e\u0644 \u0631\u0633\u0627\u0644\u062a\u0643...",onChange:function(e){return c(e.target.value)},className:"flex-1 align-bottom px-6 py-3 rounded-lg outline-none text-gray-900 focus:outline-none overflow-y-auto resize-none min-h-[1em] max-h-[10em]",onInput:o,onKeyPress:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),l())}}),Object(j.jsxs)("button",{type:"submit",disabled:e.disabledSend,className:"space-x-2 space-x-reverse mb-2 disabled:hover:text-primary-200/50 disabled:text-primary-200/50 disabled:cursor-default hover:text-accent text-lg 2xl:text-xl focus:outline-none focus:text-accent",children:[Object(j.jsx)("span",{children:"\u0625\u0631\u0633\u0627\u0644"}),Object(j.jsx)("i",{className:"fas fa-paper-plane"})]})]})})}f.Messages=p,f.NoMessages=function(e){return Object(j.jsx)("div",{className:"flex flex-1 items-center justify-center ".concat(e.className),children:Object(j.jsx)("p",{className:"text-gray-200",children:e.children})})},f.MessagesLoading=function(){return Object(j.jsx)("div",{className:"h-full flex items-center justify-center",children:Object(j.jsx)("p",{className:"text-gray-200",children:Object(j.jsx)("i",{className:"fa fa-spinner text-4xl fa-fw fa-pulse my-2"})})})},f.WelcomeHeader=function(e){return Object(j.jsxs)("header",{className:"text-center ".concat(e.className),children:[Object(j.jsx)("h1",{className:"text-3xl font-bold text-primary",children:"\u0645\u0631\u0643\u0632 \u0627\u0644\u0645\u0633\u0627\u0639\u062f\u0629"}),Object(j.jsxs)("div",{className:"mb-2 mt-1 relative",children:[Object(j.jsx)("span",{className:"inline-block w-52 h-1 bg-accent"}),Object(j.jsx)("span",{className:"absolute left-1/2 -translate-x-1/2 translate-y-1/4 inline-block w-5 h-5 border-4 border-accent bg-white rounded-full"})]}),Object(j.jsx)("p",{children:"\u0644\u062f\u064a\u0643 \u0627\u0633\u0626\u0644\u0629 \u061f \u062a\u062d\u062f\u062b \u0645\u0639 \u0627\u062d\u062f \u0645\u0645\u062b\u0644\u064a \u062e\u062f\u0645\u0629 \u0627\u0644\u0639\u0645\u0644\u0627\u0621"})]})},p.Message=n.a.forwardRef((function(e,t){var a=m(e.timestamp);return"transferring"===e.type?Object(j.jsx)("div",{className:"mb-6 mt-12 flex",children:Object(j.jsx)("div",{className:"inline-block mx-auto p-2 px-4 rounded-full bg-gray-300 text-white",children:e.text})}):Object(j.jsx)("div",{className:"flex ".concat(e.received?"justify-end":"justify-start"," ").concat(e.withNext?"mb-2":"mb-6"),children:Object(j.jsxs)("div",{className:"flex items-end space-x-2 ".concat(e.received?"flex-row-reverse":"space-x-reverse"),children:[Object(j.jsxs)("div",{ref:t,className:"break-all whitespace-pre-wrap text-primary-50 select-text max-w-full sm:max-w-sm ".concat(e.received?"rounded-bl-none bg-primary-400":"rounded-br-none bg-primary-500"," \n              ").concat(e.attachmentsURL?"pt-3 pb-2 px-3 sm:pt-4 sm:pb-3 sm:px-4":"py-3 px-6","\n              rounded-xl"),children:[e.attachmentsURL&&Object(j.jsx)("div",{className:"relative group cursor-pointer",children:"image"===e.type?Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("div",{className:"w-full h-full absolute bg-primary-400/10 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-6xl",onClick:function(){return e.attachmentsURL&&e.onSelectAttachment(e.attachmentsURL.href)},children:Object(j.jsx)("i",{className:"far fa-search-plus text-white"})}),Object(j.jsx)("img",{src:e.attachmentsURL.href,alt:"media",className:"mb-2 sm:mb-3 min-w-[8rem] min-h-[2rem]"})]}):Object(j.jsxs)("a",{href:e.attachmentsURL.href,download:!0,className:"flex items-center space-x-3 space-x-reverse",children:[Object(j.jsxs)("span",{className:"rounded-full w-12 h-12 group flex items-center justify-center text-primary bg-primary-50",children:[Object(j.jsx)("i",{className:"fa ".concat(e.attachmentsURL.pathname.endsWith(".zip")?"fa-file-archive":e.attachmentsURL.pathname.endsWith(".pdf")?"fa-file-pdf":e.attachmentsURL.pathname.endsWith(".docx")||e.attachmentsURL.pathname.endsWith(".doc")?"fa-file-word":"fa-file"," text-2xl group-hover:hidden")}),Object(j.jsx)("i",{className:"fa fa-file-download text-2xl hidden group-hover:inline"})]}),Object(j.jsx)("span",{dir:"auto",children:e.attachmentsURL.pathname.split("/").pop()})]})}),Object(j.jsx)("div",{dir:"auto",children:e.text})]}),Object(j.jsxs)("span",{className:"mx-1 ".concat(a?"mb-3":""," space-x-2 whitespace-nowrap align-top text-gray-200 flex items-center select-text ").concat(e.received?"flex-row-reverse":"space-x-reverse"),children:[!e.received&&(e.sent?Object(j.jsx)("i",{className:"fas fa-check ".concat(e.read?"text-accent":"text-gray-200")}):Object(j.jsx)("i",{className:"fas fa-clock"})),Object(j.jsxs)("time",{title:e.timestamp.toLocaleString(),className:"flex space-x-1 space-x-reverse",children:[!a&&Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("span",{className:"text-gray-300",children:e.timestamp.toLocaleDateString()}),Object(j.jsx)("span",{children:"-"})]}),Object(j.jsx)("span",{children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})]})})}));var h=a(36);function v(e){var t=e.username,a=e.backUrl,r=e.unreadMessagesCount,n=e.notificationsItems,c=e.className;return Object(j.jsx)("header",{className:"bg-primary py-4 px-14 text-primary-50 ".concat(c),children:Object(j.jsxs)("div",{className:"flex mx-auto",children:[Object(j.jsx)("div",{className:"flex items-center space-x-3 sm:space-x-4 space-x-reverse sm:space-x-reverse",children:Object(j.jsxs)("span",{className:"text-primary-200",children:["\u0645\u0631\u062d\u0628\u0627"," ",t]})}),Object(j.jsxs)("div",{className:"mr-auto flex items-center space-x-3 sm:space-x-4 space-x-reverse sm:space-x-reverse",children:[n&&Object(j.jsxs)(h.a,{children:[Object(j.jsxs)(h.b,{className:"relative",children:[Object(j.jsx)("i",{className:"fa fa-comment-alt text-xl"}),r&&r>0?Object(j.jsx)("span",{className:"min-w-[1.4em] h-5 px-1 text-sm font-bold absolute translate-x-2/4 -translate-y-1/4 bg-red-400 rounded-full ring-2 ring-primary",children:r}):null]}),Object(j.jsx)(h.d,{dir:"rtl",className:"py-2 bg-white border border-gray-50 rounded-sm divide-y divide-gray-100 max-h-[50vh] overflow-y-auto",children:n.length?n:Object(j.jsx)(h.c,{className:"py-2 px-4 min-w-[10em] max-w-sm text-center text-gray-200",onSelect:function(){},children:"\u0644\u0627 \u064a\u0648\u062c\u062f \u0631\u0633\u0627\u0626\u0644 \u0648\u0627\u0631\u062f\u0629"})})]}),a&&Object(j.jsxs)("a",{href:a,className:"space-x-2 space-x-reverse text-primary-200",children:[Object(j.jsx)("span",{children:"\u0631\u062c\u0648\u0639"}),Object(j.jsx)("i",{className:"fa fa-share fa-flip-horizontal"})]})]})]})})}function O(e){return Object(j.jsx)("div",{className:"w-80 bg-primary-50 overflow-y-auto",children:e.children})}v.RoomItem=function(e){var t=e.active,a=e.name,r=e.unreadCount,n=e.onSelect;return Object(j.jsxs)(h.c,{className:"py-2 px-4 cursor-pointer min-w-[10em] active:bg-primary active:text-primary-50 flex items-center justify-between space-x-reverse space-x-2 ".concat(t?"bg-primary text-primary-50":"hover:bg-primary-100"),onSelect:function(){return n()},children:[Object(j.jsxs)("span",{children:[Object(j.jsx)("i",{className:"fa fa-user ".concat(t?"text-white":r?"text-primary":"text-gray-200")}),Object(j.jsx)("span",{className:"mr-2",children:a})]}),r>0&&Object(j.jsx)("span",{className:"min-w-[1.4em] h-5 px-1 text-sm font-bold bg-red-400 text-white rounded-full text-center",children:r})]})},v.MessageNotificationItem=function(e){var t=e.name,a=e.createdAt,r=e.read,n=e.message,c=e.onSelect;return Object(j.jsxs)(h.c,{className:"py-2 px-4 cursor-pointer hover:bg-primary-100 min-w-[15em] max-w-sm active:bg-primary-600 group active:text-primary-50 flex flex-row space-x-4 space-x-reverse",onSelect:function(){return c&&c()},children:[Object(j.jsx)("div",{children:r?Object(j.jsx)("span",{className:"rounded-full w-12 h-12 flex items-center justify-center text-primary bg-primary-50",children:Object(j.jsx)("i",{className:"fa fa-envelope-open text-2xl"})}):Object(j.jsx)("span",{className:"rounded-full w-12 h-12 flex items-center justify-center text-white bg-red-400",children:Object(j.jsx)("i",{className:"fa fa-envelope text-xl"})})}),Object(j.jsxs)("div",{children:[Object(j.jsx)("span",{className:"group-active:text-primary-100 font-bold ".concat(r?"text-gray-200":"text-primary"),children:t}),Object(j.jsx)("br",{}),Object(j.jsx)("span",{children:n}),Object(j.jsx)("br",{}),Object(j.jsx)("time",{className:"text-gray-200",children:function(e){var t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}(a)?a.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}):a.toLocaleString()})]})]})},O.Search=function(e){return Object(j.jsx)("div",{className:"border-b px-2 py-2",children:Object(j.jsxs)("div",{className:"flex py-2 px-3 items-center rounded-full bg-gray-100",children:[Object(j.jsx)("i",{className:"fa fa-search text-gray-400"}),Object(j.jsx)("input",{type:"text",placeholder:"\u0627\u0628\u062d\u062b \u0628\u0627\u0633\u0645 \u0627\u0644\u0639\u0645\u064a\u0644",className:"flex-1 px-2 outline-none bg-transparent",onChange:function(t){return e.onChange(t.target.value)}})]})})},O.Room=function(e){var t,a,r,n;return Object(j.jsxs)("div",{onClick:function(){return e.onSelect()},className:"pt-4 flex space-x-3 space-x-reverse group ".concat(e.active?"bg-primary text-gray-100":"cursor-pointer hover:bg-gray-200"),children:[Object(j.jsx)("span",{className:"mr-2 align-middle w-12 h-12 rounded-full flex items-center justify-center bg-primary-100 text-primary-800",children:Object(j.jsx)("i",{className:"fa fa-user text-xl"})}),Object(j.jsxs)("div",{className:"flex-1 ".concat(!e.active&&"border-b"," pb-4 pl-3"),children:[Object(j.jsxs)("div",{className:"flex justify-between",children:[Object(j.jsx)("div",{children:e.name}),(null===(t=e.latestMessage)||void 0===t?void 0:t.sentAt)&&Object(j.jsx)("span",{className:"".concat(e.active?"text-gray-100":"text-gray-300 group-hover:text-gray-400"),children:(n=null===(a=e.latestMessage)||void 0===a?void 0:a.sentAt,m(n)?n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):n.toLocaleDateString())})]}),Object(j.jsxs)("div",{className:"flex justify-between mt-2 min-h-[1rem]",children:[(null===(r=e.latestMessage)||void 0===r?void 0:r.text)&&Object(j.jsxs)("span",{className:"space-x-2 space-x-reverse flex items-center ".concat(e.active?"text-gray-100":"text-gray-300 group-hover:text-gray-400"),children:[Object(j.jsx)("span",{children:Object(j.jsx)("i",{className:"fas fa-check ".concat(e.latestMessage.read?"text-accent":"text-gray-200")})}),Object(j.jsx)("span",{title:e.latestMessage.text,className:"max-w-[13ch] whitespace-nowrap overflow-hidden overflow-ellipsis",children:e.latestMessage.text})]}),(e.unreadMessages||0)>0&&Object(j.jsx)("span",{className:"h-5 w-5 flex justify-center items-center font-bold text-red-100 bg-red-400 rounded-full",children:e.unreadMessages})]})]})]})},O.NoRooms=function(){return Object(j.jsx)("div",{dir:"auto",className:"py-12 text-center text-gray-300",children:"\u0644\u0627 \u064a\u0648\u062c\u062f \u0639\u0645\u0644\u0627\u0621"})};var g=a(32),y=a(24),w=a(10),N=function(e,t,a){return Object(w.c)(e,"messages").withConverter(function(e,t){return{toFirestore:function(a){if(!t)throw new Error("Trying to convert message to firestore but no room provided.");return{created_at:String(Date.now()),roomId:t.id,from_type:"agent"===e.type?"App\\User":"App\\customer",to_type:"agent"===e.type?"App\\customer":"App\\User",senderId:e.id,receiverId:"agent"===e.type?t.customer.id:t.agent.id,is_read:a.read?1:0,message_type:a.type,file:a.filename||"",text:a.text||"",updated_at:w.a.now(),userName:null===e||void 0===e?void 0:e.name}},fromFirestore:function(t){var a=t.data();return{id:t.id,roomId:a.roomId,created_at:new Date(Number(a.created_at)),read:Boolean(a.is_read),received:a.senderId!==e.id,status:"sent",text:a.text,filename:a.file?a.file:void 0,type:"image"===a.message_type||"file"===a.message_type?a.message_type:"transferring"===a.message_type?"transferring":"text"}}}}(t,a))};function S(e,t,a){return Object(w.q)(N(e,t,a),Object(w.t)("roomId","==",a.id),Object(w.t)("receiverId","==",t.id),Object(w.t)("is_read","==",0),Object(w.p)("created_at","asc"))}function M(){return(M=Object(l.a)(o.a.mark((function e(t,a,r){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(w.u)(t),e.next=3,Object(w.i)(S(t,a,r));case 3:return e.sent.forEach((function(e){n.update(e.ref.withConverter(null),{is_read:1})})),e.next=7,n.commit();case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _=a(6),I=a(1),A=a(8),k=a(9),E=a(31),C=function(e){Object(A.a)(a,e);var t=Object(k.a)(a);function a(){return Object(I.a)(this,a),t.apply(this,arguments)}return a}(Object(E.a)(Error));function R(e,t){return U.apply(this,arguments)}function U(){return(U=Object(l.a)(o.a.mark((function e(t,a){var r,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.authUser.baseUrl){e.next=2;break}throw new C("No base Url provided.");case 2:return e.next=4,fetch("".concat(window.authUser.baseUrl,"/FcmToken?type=").concat(t,"&id=").concat(a));case 4:if((r=e.sent).ok){e.next=7;break}throw new Error(r.statusText);case 7:return e.next=9,r.json();case 9:return n=e.sent,e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var L={agents:new Map,customers:new Map};function T(e,t){return F.apply(this,arguments)}function F(){return(F=Object(l.a)(o.a.mark((function e(t,a){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("agent"!==t||!L.agents.has(a)){e.next=2;break}return e.abrupt("return",L.agents.get(a));case 2:if("customer"!==t||!L.customers.has(a)){e.next=4;break}return e.abrupt("return",L.customers.get(a));case 4:return e.next=6,R(t,a);case 6:return r=e.sent,"agent"===t&&L.agents.set(a,r),"customer"===t&&L.agents.set(a,r),e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t,a){return D.apply(this,arguments)}function D(){return(D=Object(l.a)(o.a.mark((function e(t,a,r){var n,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(_.a)(t);try{for(n.s();!(c=n.n()).done;)s=c.value,fetch("https://fcm.googleapis.com/fcm/send",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Key=".concat("AAAA8F3ereU:APA91bESPMz7qdvt5xoMX0cucM_-2iBAoEP0I9SXFr0rKJrQeGcM0Zv9VWKf-eZt5lG7ntx3vkj34bF_oROPCj6b39OS-bPA6a5E6hofWBRpJSfkQEpCD8pojrHMBxVpnc5TocMXZawM")},body:JSON.stringify({to:s,notification:{title:a,body:r}})})}catch(i){n.e(i)}finally{n.f()}case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t,a){return W.apply(this,arguments)}function W(){return(W=Object(l.a)(o.a.mark((function e(t,a,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=P,e.next=3,T(a,r);case 3:return e.t1=e.sent,e.t2=x(t),e.next=7,(0,e.t0)(e.t1,"\u0644\u062f\u064a\u0643 \u0631\u0633\u0627\u0644\u0629 \u062c\u062f\u064a\u062f\u0629",e.t2);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=a(16),H=a(70),q=a(55);function z(){var e;return Object(H.a)(Object(u.a)(Object(u.a)({},q),{},{projectId:null!==(e=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_CLOUD_MESSAGING_SERVER_KEY:"AAAA8F3ereU:APA91bESPMz7qdvt5xoMX0cucM_-2iBAoEP0I9SXFr0rKJrQeGcM0Zv9VWKf-eZt5lG7ntx3vkj34bF_oROPCj6b39OS-bPA6a5E6hofWBRpJSfkQEpCD8pojrHMBxVpnc5TocMXZawM",REACT_APP_WSATA_API_URL:"https://alwsata.com.sa/chat-api"}).REACT_APP_FIREBASE_PROJECT_ID)&&void 0!==e?e:q.projectId}))}var J={toFirestore:function(e){return{AgentId:String(e.agent.id),UserId:String(e.customer.id),UserName:e.customer.name}},fromFirestore:function(e){var t=e.data();return{id:e.id,customer:{id:t.UserId,name:t.UserName},agent:{id:t.AgentId}}}},V=function(e){return Object(w.c)(e,"rooms").withConverter(J)};function G(e,t){return Q.apply(this,arguments)}function Q(){return(Q=Object(l.a)(o.a.mark((function e(t,a){var r,n,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(w.q)(V(t),Object(w.t)("UserId","==",a.id),Object(w.m)(1)),e.next=3,Object(w.i)(r);case 3:return n=e.sent,c=n.docs,e.abrupt("return",c.length?c[0].ref:null);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var X=function(e){Object(A.a)(a,e);var t=Object(k.a)(a);function a(e){var r;return Object(I.a)(this,a),(r=t.call(this,e)).name="\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u0645\u0635\u0627\u062f\u0642\u0629",r}return a}(Object(E.a)(Error));function Y(e,t){return fetch("https://alwsata.com.sa/chat-api"+e,Object(u.a)(Object(u.a)({},t||{}),{},{mode:"cors",credentials:"include",headers:{Accept:"application/json"}}))}function Z(){return(Z=Object(l.a)(o.a.mark((function e(t,a,r){var n,c,s,i,l,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).append("file",t),"agent"===a.type&&n.append("to_customer_id",r.customer.id),e.next=5,Y("/file",{method:"POST",body:n});case 5:if((c=e.sent).ok){e.next=8;break}throw new Error(c.statusText);case 8:return e.next=10,c.json();case 10:return s=e.sent,i=s.data,l=i.filename,u=i.type,e.abrupt("return",{filename:l,type:u});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $=Object(r.createContext)({}),ee=Object(r.createContext)({}),te=Object(r.createContext)({}),ae=new K.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:!1}}});var re=function(){return Object(j.jsx)("div",{className:"selection:bg-accent selection:text-accent-50 select-none",dir:"rtl",children:Object(j.jsx)(K.QueryClientProvider,{client:ae,children:Object(j.jsx)(ne,{})})})};function ne(){var e=Object(r.useMemo)(z,[]),t=function(){var e,t=window.authUser||window.parent.authUser;return{user:t?{id:String(t.id),type:t.userType,name:t.name,backURL:null!==(e=t.redirect_url)&&void 0!==e?e:void 0}:void 0}}(),a=Object(r.useMemo)((function(){return t=e,Object(w.l)(t);var t}),[e]);return t.user?Object(j.jsxs)($.Provider,{value:{firebase:e,firestore:a},children:["customer"===t.user.type&&Object(j.jsx)(ee.Provider,{value:t.user,children:Object(j.jsx)(ie,{})}),"agent"===t.user.type&&Object(j.jsx)(te.Provider,{value:t.user,children:Object(j.jsx)(ce,{})})]}):Object(j.jsx)(de,{error:new X("\u0645\u0646 \u0641\u0636\u0644\u0643\u060c \u0633\u062c\u0644 \u0627\u0644\u062f\u062e\u0648\u0644 \u0641\u064a \u062d\u0633\u0627\u0628\u0643")})}function ce(){var e,t,a,n=Object(r.useContext)(te),c=Object(r.useContext)($).firestore,s=Object(r.useState)(),i=Object(d.a)(s,2),o=i[0],l=i[1],u=Object(r.useState)(),m=Object(d.a)(u,2),f=m[0],p=m[1],b=Object(r.useState)(new Map),h=Object(d.a)(b,2),S=h[0],M=h[1],_=Object(g.c)("rooms",(t=c,a=n,Object(w.q)(V(t),Object(w.t)("AgentId","==",a.id))),{subscribe:!0},{enabled:Boolean(n&&c)}),I=Object(g.c)("unread-messages",function(e,t,a){return w.q.apply(void 0,[N(e,t),Object(w.t)("receiverId","==",t.id),Object(w.t)("is_read","==",0)].concat(Object(y.a)((null===a||void 0===a?void 0:a.id)?[Object(w.t)("roomId","!=",a.id),Object(w.p)("roomId")]:[]),[Object(w.p)("created_at","desc")]))}(c,n),{subscribe:!0},{enabled:Boolean(n)}),A=Object(r.useMemo)((function(){var e;return(null===(e=I.data)||void 0===e?void 0:e.filter((function(e){var t;return null===(t=_.data)||void 0===t?void 0:t.find((function(t){return t.id===e.roomId}))})))||[]}),[_.data,I.data]),k=function(e,t){var a=Object(r.useState)(e),n=Object(d.a)(a,2),c=n[0],s=n[1];return Object(r.useEffect)((function(){var a=setTimeout((function(){s(e)}),t);return function(){clearTimeout(a)}}),[e,t]),c}(A.length||0,200),E=Object(r.useMemo)((function(){if(_.data){var e=new Map(_.data.map((function(e){return[e.id,0]})));return A.forEach((function(t){e.set(t.roomId,(e.get(t.roomId)||0)+1)})),e}}),[_.data,A]),C=function(e){var t,a=null===(t=_.data)||void 0===t?void 0:t.find((function(t){return t.id===e}));l(a)},R=function(e){M((function(t){var a=new Map(t);return a.set(e.roomId,e),a}))};return Object(j.jsxs)("div",{className:"flex flex-col h-screen",children:[_.data&&Object(j.jsx)(v,{username:n.name,backUrl:n.backURL,unreadMessagesCount:k,notificationsItems:A.map((function(e){var t;return Object(j.jsx)(v.MessageNotificationItem,{name:(null===(t=_.data.find((function(t){return t.id===e.roomId})))||void 0===t?void 0:t.customer.name)||"\u0639\u0645\u064a\u0644",message:x(e),createdAt:e.created_at,read:e.read,onSelect:function(){return C(e.roomId)}},e.id)}))}),Object(j.jsxs)("div",{className:"flex-1 h-0 flex items-stretch divide-x divide-x-reverse",children:[Object(j.jsx)(O,{children:(null===(e=_.data)||void 0===e?void 0:e.length)?Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(O.Search,{onChange:p}),_.data.filter((function(e){return!f||e.customer.name.match(f)})).sort((function(e,t){var a,r=S.get(e.id),n=S.get(t.id);return!r&&n?1:!n&&r?-1:null!==(a=r&&n&&n.created_at.getTime()-r.created_at.getTime())&&void 0!==a?a:0})).map((function(e){return Object(j.jsx)(se,{room:e,user:n,name:e.customer.name,active:(null===o||void 0===o?void 0:o.id)===e.id,onSelect:function(){return C(e.id)},unreadMessages:null===E||void 0===E?void 0:E.get(e.id),onLatestMessageChange:R},e.id)}))]}):Object(j.jsx)(O.NoRooms,{})}),Object(j.jsx)("div",{className:"flex-1",children:o&&Object(j.jsx)(oe,{user:n,room:o,noMessagesMessage:"\u0644\u0627 \u064a\u0648\u062c\u062f \u0631\u0633\u0627\u0626\u0644",className:"h-full"},o.id)})]})]})}function se(e){var t,a,n,c=Object(r.useContext)($).firestore,s=Object(g.c)(["room-latest-message",e.room.id],(t=c,a=e.user,n=e.room,Object(w.q)(N(t,a,n),Object(w.t)("roomId","==",n.id),Object(w.p)("created_at","desc"),Object(w.m)(1))),{subscribe:!0}),i=Object(r.useMemo)((function(){return(null===s||void 0===s?void 0:s.data)&&s.data[0]}),[s.data]);return Object(r.useEffect)((function(){i&&e.onLatestMessageChange(i)}),[i]),Object(j.jsx)(O.Room,Object(u.a)(Object(u.a)({},e),{},{latestMessage:i?{text:x(i),sentAt:i.created_at,read:i.read}:void 0}))}function ie(){var e,t,a=Object(r.useContext)(ee),n=Object(r.useContext)($).firestore,c=Object(K.useQuery)("roomquery",Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",G(n,a));case 1:case"end":return e.stop()}}),e)})))),s=Object(g.b)("room",null!==(e=null===c||void 0===c?void 0:c.data)&&void 0!==e?e:Object(w.e)(n,"_STUB_/stub"),{subscribe:!0},{enabled:Boolean(c.data)});return c.isLoading||s.isLoading?Object(j.jsx)(ue,{}):c.error||s.error||!s.data?Object(j.jsx)(de,{error:c.error||s.error||new Error("No room for cutomer ".concat(a.id,"."))}):Object(j.jsxs)("div",{className:"flex flex-col h-screen relative",children:[Object(j.jsx)(v,{username:a.name,backUrl:a.backURL,className:"sticky top-0 z-50"}),Object(j.jsx)(oe,{user:a,room:s.data,noMessagesMessage:"\u062a\u0641\u0636\u0644 \u0628\u0627\u0644\u0633\u0624\u0627\u0644",showWelcomeHeader:!0,className:"flex-1 h-0"},null===(t=s.data)||void 0===t?void 0:t.id)]})}function oe(e){var t,a,n,c,s=e.noMessagesMessage,i=e.showWelcomeHeader,u=e.className,m=e.user,x=e.room,p=Object(r.useContext)($).firestore,b=function(e,t,a){var r=N(e,t,a);return Object(g.a)(r,{onSuccess:function(){var e=Object(l.a)(o.a.mark((function e(r){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.f)(r);case 2:return e.next=4,e.sent.data({});case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return");case 7:B(n,"agent"===t.type?"customer":"agent","agent"===t.type?a.customer.id:a.agent.id).catch((function(e){console.warn("Cannot send push notification for message",e)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})}(p,m,x),h=b.mutate,v=Object(g.c)(["messages",x.id],function(e,t,a){return Object(w.q)(N(e,t,a),Object(w.t)("roomId","==",a.id),Object(w.p)("created_at","asc"))}(p,m,x),{subscribe:!0});Object(r.useEffect)((function(){v.refetch()}),[]),Object(r.useEffect)((function(){v.data&&function(e,t,a){M.apply(this,arguments)}(p,m,x)}),[p,m,v.data,x]);var O=function(e){var t=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e;null===(e=t.current)||void 0===e||e.scrollIntoView()}),[null!==e&&void 0!==e?e:t.current]),t}(null===(t=v.data)||void 0===t?void 0:t[(null===(a=v.data)||void 0===a?void 0:a.length)-1]),y=Object(r.useState)(),S=Object(d.a)(y,2),_=S[0],I=S[1];return v.error?Object(j.jsxs)(f.NoMessages,{className:"text-center",children:[v.error.name,Object(j.jsx)("br",{}),v.error.message]}):Object(j.jsxs)("div",{className:"flex flex-col relative ".concat(u),children:[_&&Object(j.jsx)("div",{className:"absolute w-full h-full bg-gray/50 flex items-center justify-center z-50",onClick:function(){return I(void 0)},children:Object(j.jsx)("img",{src:_,alt:"preview",className:"max-w-full mx-8 sm:max-w-6xl object-contain"})}),Object(j.jsxs)(f,{className:"flex-1",children:[i&&Object(j.jsx)(f.WelcomeHeader,{className:"mb-8"}),v.isLoading?Object(j.jsx)(f.MessagesLoading,{}):(null===(n=v.data)||void 0===n?void 0:n.length)?Object(j.jsx)(f.Messages,{children:null===(c=v.data)||void 0===c?void 0:c.map((function(e,t,a){var r,n=t===a.length-1,c=a.length>1&&a[n?t-1:t+1].received===e.received;return Object(j.jsx)(f.Messages.Message,{ref:n?O:null,received:e.received,withNext:!n&&c,sent:"sent"===e.status,read:e.read,timestamp:new Date(e.created_at),type:e.type,text:e.text,attachmentsURL:e.filename?(r=e.filename,new URL("".concat("https://alwsata.com.sa/chat-api","/file/").concat(r))):void 0,onSelectAttachment:I},e.id)}))}):Object(j.jsx)(f.NoMessages,{children:s})]}),Object(j.jsx)(le,{room:x,sender:m,onSend:function(e,t){var a;h({text:e,filename:null===t||void 0===t?void 0:t.filename,type:null!==(a=null===t||void 0===t?void 0:t.type)&&void 0!==a?a:"text"})}})]})}function le(e){var t,a=e.room,r=e.sender,n=e.onSend,c=Object(K.useMutation)((function(e){return function(e,t,a){return Z.apply(this,arguments)}(e,r,a)})),s=function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=n,e.t1=void 0,e.next=4,c.mutateAsync(t);case 4:e.t2=e.sent,(0,e.t0)(e.t1,e.t2),c.reset();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i=function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(j.jsxs)("div",{children:[c.isLoading&&Object(j.jsxs)("div",{className:"max-w-2xl mx-auto p-4 space-x-2 space-x-reverse flex items-center",children:[Object(j.jsx)("i",{className:"fa fa-spinner fa-2x fa-fw fa-pulse my-2 text-gray-300"}),Object(j.jsx)("span",{children:"\u062c\u0627\u0631 \u0627\u0644\u0631\u0641\u0639"}),Object(j.jsxs)("span",{dir:"auto",children:["[",null===(t=c.variables)||void 0===t?void 0:t.name,"]"]})]}),Object(j.jsx)(b,{disabledSend:c.isLoading,onSelectFiles:s,onSend:i})]})}function ue(){return Object(j.jsx)("div",{className:"flex flex-col items-center justify-center h-screen text-primary",dir:"auto",children:Object(j.jsx)("i",{className:"fa fa-spinner fa-2x text-gray-300 fa-fw fa-pulse my-2"})})}function de(e){return Object(j.jsxs)("div",{className:"h-screen flex flex-col items-center justify-center",children:[Object(j.jsx)("h2",{className:"text-2xl text-primary mb-4",children:"\u062d\u062f\u062b \u062e\u0637\u0623"}),Object(j.jsxs)("pre",{className:"text-center leading-6",children:[e.error.name,Object(j.jsx)("br",{}),e.error.message,Object(j.jsx)("br",{}),e.children]})]})}var me=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,89)).then((function(t){var a=t.getCLS,r=t.getFID,n=t.getFCP,c=t.getLCP,s=t.getTTFB;a(e),r(e),n(e),c(e),s(e)}))};s.a.render(Object(j.jsx)(n.a.StrictMode,{children:Object(j.jsx)(re,{})}),document.getElementById("root")),me()}},[[86,1,2]]]);
//# sourceMappingURL=main.f71936ef.chunk.js.map